use serde::{Deserialize, Serialize};
use serde_with::{serde_as, BoolFromInt};
use validator::Validate;

// TODO: change to enum depending on color mode
#[derive(Serialize, Deserialize, Validate, Debug)]
#[serde(deny_unknown_fields)]
pub struct ColorParams {
    #[serde(rename(serialize = "@colorMode", deserialize = "colorMode"))]
    pub color_mode: ColorMode,

    #[serde(rename = "color-or-grayscale")]
    #[validate]
    pub color_or_grayscale: ColorOrGrayscale,

    #[validate]
    pub bw: Option<BW>,
}

#[derive(Serialize, Deserialize, Eq, PartialEq, Debug)]
pub enum ColorMode {
    #[serde(rename = "bw")]
    BlackAndWhite,
    #[serde(rename = "colorOrGray")]
    ColorOrGrayscale,
    #[serde(rename = "mixed")]
    Mixed,
}

#[serde_as]
#[derive(Serialize, Deserialize, Validate, Debug)]
#[serde(deny_unknown_fields)]
pub struct ColorOrGrayscale {
    #[serde(rename(serialize = "@fillMargins", deserialize = "fillMargins"))]
    #[serde_as(as = "BoolFromInt")]
    pub fill_margins: bool,

    #[serde(rename(serialize = "@fillOffcut", deserialize = "fillOffcut"))]
    #[serde_as(as = "BoolFromInt")]
    pub fill_offcut: bool,

    #[serde(rename(serialize = "@fillingColor", deserialize = "fillingColor"))]
    pub filling_color: FillingColor,

    #[serde(rename(
        serialize = "@normalizeIlluminationColor",
        deserialize = "normalizeIlluminationColor"
    ))]
    #[serde_as(as = "BoolFromInt")]
    pub normalize_illumination_color: bool,

    #[serde(rename = "posterization-options")]
    #[validate]
    pub posterization_options: PosterizationOptions,
}

#[derive(Serialize, Deserialize, Eq, PartialEq, Debug)]
#[serde(rename_all = "kebab-case")]
pub enum FillingColor {
    Background,
    White,
    Black,
}

#[serde_as]
#[derive(Serialize, Deserialize, Validate, Debug)]
#[serde(deny_unknown_fields)]
pub struct PosterizationOptions {
    #[serde(rename(serialize = "@enabled"))]
    #[serde_as(as = "BoolFromInt")]
    pub enabled: bool,

    #[serde(rename(serialize = "@forceBlackAndWhite", deserialize = "forceBlackAndWhite"))]
    #[serde_as(as = "BoolFromInt")]
    pub force_black_and_white: bool,

    #[serde(rename(serialize = "@level"))]
    #[validate(range(min = 2))]
    pub level: u8,

    #[serde(rename(
        serialize = "@normalizationEnabled",
        deserialize = "normalizationEnabled"
    ))]
    #[serde_as(as = "BoolFromInt")]
    pub normalization_enabled: bool,
}

#[serde_as]
#[derive(Serialize, Deserialize, Validate, Debug)]
#[serde(deny_unknown_fields)]
pub struct BW {
    #[serde(rename(serialize = "@binarizationMethod", deserialize = "binarizationMethod"))]
    pub binarization_method: BinarizationMethod,

    #[serde(rename(
        serialize = "@morphologicalSmoothing",
        deserialize = "morphologicalSmoothing"
    ))]
    #[serde_as(as = "BoolFromInt")]
    pub morphological_smoothing: bool,

    #[serde(rename(
        serialize = "@normalizeIlluminationBW",
        deserialize = "normalizeIlluminationBW"
    ))]
    #[serde_as(as = "BoolFromInt")]
    pub normalize_illumination_bw: bool,

    #[serde(rename(serialize = "@sauvolaCoef", deserialize = "sauvolaCoef"))]
    #[validate(range(min = 0.01, max = 9.99))]
    pub sauvola_coeff: f64,

    #[serde(rename(
        serialize = "@savitzkyGolaySmoothing",
        deserialize = "savitzkyGolaySmoothing"
    ))]
    #[serde_as(as = "BoolFromInt")]
    pub savitzky_golay_smoothing: bool,

    #[serde(rename(serialize = "@thresholdAdj", deserialize = "thresholdAdj"))]
    #[validate(range(min = -100, max = 100))]
    pub threshold_adj: i8,

    #[serde(rename(serialize = "@windowSize", deserialize = "windowSize"))]
    #[validate(range(min = 3, max = 9999))]
    pub window_size: u16,

    #[serde(rename(serialize = "@wolfCoef", deserialize = "wolfCoef"))]
    #[validate(range(min = 0.01, max = 9.99))]
    pub wolf_coeff: f64,

    #[serde(rename(serialize = "@wolfLowerBound", deserialize = "wolfLowerBound"))]
    #[validate(range(min = 1, max = 254))]
    pub wolf_lower_bound: u8,

    #[serde(rename(serialize = "@wolfUpperBound", deserialize = "wolfUpperBound"))]
    #[validate(range(min = 1, max = 254))]
    pub wolf_upper_bound: u8,

    #[serde(rename = "color-segmenter-options")]
    #[validate]
    pub color_segmenter_options: ColorSegmenterOptions,
}

#[derive(Serialize, Deserialize, Eq, PartialEq, Debug)]
#[serde(rename_all = "lowercase")]
pub enum BinarizationMethod {
    Otsu,
    Sauvola,
    Wolf,
    EdgePlus,
    BlurDiv,
    EdgeDiv,
}

#[serde_as]
#[derive(Serialize, Deserialize, Validate, Debug)]
#[serde(deny_unknown_fields)]
pub struct ColorSegmenterOptions {
    #[serde(rename(
        serialize = "@blueThresholdAdjustment",
        deserialize = "blueThresholdAdjustment"
    ))]
    #[validate(range(min = -99, max = 99))]
    pub blue_threshold_adjustment: i8,

    #[serde(rename(serialize = "@enabled"))]
    #[serde_as(as = "BoolFromInt")]
    pub enabled: bool,

    #[serde(rename(
        serialize = "@greenThresholdAdjustment",
        deserialize = "greenThresholdAdjustment"
    ))]
    #[validate(range(min = -99, max = 99))]
    pub green_threshold_adjustment: i8,

    #[serde(rename(serialize = "@noiseReduction", deserialize = "noiseReduction"))]
    #[validate(range(min = 0, max = 999))]
    pub noise_reduction: u16,

    #[serde(rename(
        serialize = "@redThresholdAdjustment",
        deserialize = "redThresholdAdjustment"
    ))]
    #[validate(range(min = -99, max = 99))]
    pub red_threshold_adjustment: i8,
}

#[cfg(test)]
mod test {
    use serde_xml_rs::from_str;

    use crate::project::{
        filters::output::common::color_params::{BinarizationMethod, ColorMode, FillingColor},
        ProjectXML,
    };

    use super::ColorParams;

    fn get_color_params(content: &str) -> ColorParams {
        let project: ProjectXML = from_str(content).unwrap();
        let mut pages = project.filters.output.page;
        assert_eq!(pages.len(), 1);
        let page = pages.pop().unwrap();
        page.params.color_params
    }

    #[test]
    fn it_deserializes_color_mode() {
        const BLACK_AND_WHITE: &str = r#"<project layoutDirection="LTR" outputDirectory="/home/ramzi/src/bill-organizer/out" version="3"><directories><directory id="1" path="/home/ramzi/src/bill-organizer"/></directories><files><file dirId="1" id="2" name="in.jpg"/></files><images><image fileId="2" fileImage="0" id="3" subPages="1"><size height="4961" width="7016"/><dpi horizontal="600" vertical="600"/></image></images><pages><page id="4" imageId="3" selected="selected" subPage="single"/></pages><file-name-disambiguation><mapping file="2" label="0"/></file-name-disambiguation><filters><fix-orientation><image-settings><page id="4"><image-params blackOnWhite="1" bwThreshold="193"/></page></image-settings></fix-orientation><page-split defaultLayoutType="auto-detect"><image id="3" layoutType="single-uncut"><params mode="auto"><pages type="single-uncut"><outline><point x="0" y="0"/><point x="7016" y="0"/><point x="7016" y="4961"/><point x="0" y="4961"/><point x="0" y="0"/></outline></pages><dependencies><rotation degrees="0"/><size height="4961" width="7016"/><layoutType>single-uncut</layoutType></dependencies></params></image></page-split><deskew><page id="4"><params angle="0.125" mode="auto"><dependencies><rotation degrees="0"/><page-outline><point x="0" y="0"/><point x="7016" y="0"/><point x="7016" y="4961"/><point x="0" y="4961"/><point x="0" y="0"/></page-outline></dependencies></params></page><image-settings><page id="4"><image-params blackOnWhite="1" bwThreshold="193"/></page></image-settings></deskew><select-content pageDetectionTolerance="0.1"><page id="4"><params contentDetectionMode="auto" fineTuneCorners="0" pageDetectionMode="disabled"><content-rect height="3384" width="2260" x="344" y="388"/><page-rect height="4976.294719097549" width="7026.806517602445" x="0" y="0"/><content-size-mm height="143.256286512573" width="95.6735246803827"/><dependencies><rotated-page-outline><point x="10.82321443814471" y="0"/><point x="7026.806517602445" y="15.30652539770678"/><point x="7015.9833031643" y="4976.294719097549"/><point x="0" y="4960.988193699843"/><point x="10.82321443814471" y="0"/></rotated-page-outline><params contentDetectionMode="auto" fineTuneCorners="0" pageDetectionMode="disabled"/></dependencies></params></page></select-content><page-layout showMiddleRect="1"><page id="4"><params autoMargins="0"><hardMarginsMM bottom="5" left="10" right="10" top="5"/><pageRect height="4976.294719097549" width="7026.806517602445" x="0" y="0"/><contentRect height="3384" width="2260" x="344" y="388"/><contentSizeMM height="143.256286512573" width="95.6735246803827"/><alignment hor="center" null="0" vert="center"/></params></page></page-layout><output><page id="4"><zones/><fill-zones/><params blackOnWhite="1" depthPerception="2" despeckleLevel="1"><picture-shape-options higherSearchSensitivity="0" pictureShape="free" sensitivity="100"/><dewarping-options mode="off" postDeskew="1" postDeskewAngle="0"/><dpi horizontal="600" vertical="600"/><color-params colorMode="bw"><color-or-grayscale fillMargins="1" fillOffcut="1" fillingColor="background" normalizeIlluminationColor="0"><posterization-options enabled="0" forceBlackAndWhite="1" level="4" normalizationEnabled="0"/></color-or-grayscale><bw binarizationMethod="otsu" morphologicalSmoothing="1" normalizeIlluminationBW="1" sauvolaCoef="0.34" savitzkyGolaySmoothing="1" thresholdAdj="0" windowSize="200" wolfCoef="0.3" wolfLowerBound="1" wolfUpperBound="254"><color-segmenter-options blueThresholdAdjustment="0" enabled="0" greenThresholdAdjustment="0" noiseReduction="7" redThresholdAdjustment="0"/></bw></color-params><splitting originalBackground="0" splitOutput="0" splittingMode="bw"/></params><processing-params autoZonesFound="0" blackOnWhiteSetManually="0"/><output-params><image blackOnWhite="1" depthPerception="2" despeckleLevel="1"><size height="3620" width="2732"/><content-rect height="3384" width="2260" x="236" y="118"/><crop-area><point x="-97.17678556185528" y="-270"/><point x="6918.806517602445" y="-254.6934746022932"/><point x="6907.9833031643" y="4706.294719097549"/><point x="-108" y="4690.988193699843"/><point x="-97.17678556185528" y="-270"/></crop-area><partial-xform><m11>0.9999976201773518</m11><m12>0.00218165983433677</m12><m21>-0.00218165983433677</m21><m22>0.9999976201773518</m22></partial-xform><dpi horizontal="600" vertical="600"/><color-params colorMode="bw"><color-or-grayscale fillMargins="1" fillOffcut="1" fillingColor="background" normalizeIlluminationColor="0"><posterization-options enabled="0" forceBlackAndWhite="1" level="4" normalizationEnabled="0"/></color-or-grayscale><bw binarizationMethod="otsu" morphologicalSmoothing="1" normalizeIlluminationBW="1" sauvolaCoef="0.34" savitzkyGolaySmoothing="1" thresholdAdj="0" windowSize="200" wolfCoef="0.3" wolfLowerBound="1" wolfUpperBound="254"><color-segmenter-options blueThresholdAdjustment="0" enabled="0" greenThresholdAdjustment="0" noiseReduction="7" redThresholdAdjustment="0"/></bw></color-params><splitting originalBackground="0" splitOutput="0" splittingMode="bw"/><picture-shape-options higherSearchSensitivity="0" pictureShape="free" sensitivity="100"/><dewarping-options mode="off" postDeskew="1" postDeskewAngle="0"/><processing-params autoZonesFound="0" blackOnWhiteSetManually="0"/></image><source_file mtime="1698783384" size="2890349"/><file mtime="1699418538" size="26668"/><speckles mtime="1699418538" size="712"/><zones/><fill-zones/></output-params></page></output></filters></project>"#;
        const COLOR_OR_GRAYSCALE: &str = r#"<project layoutDirection="LTR" outputDirectory="/home/ramzi/src/bill-organizer/out" version="3"><directories><directory id="1" path="/home/ramzi/src/bill-organizer"/></directories><files><file dirId="1" id="2" name="in.jpg"/></files><images><image fileId="2" fileImage="0" id="3" subPages="1"><size height="4961" width="7016"/><dpi horizontal="600" vertical="600"/></image></images><pages><page id="4" imageId="3" selected="selected" subPage="single"/></pages><file-name-disambiguation><mapping file="2" label="0"/></file-name-disambiguation><filters><fix-orientation><image-settings><page id="4"><image-params blackOnWhite="1" bwThreshold="193"/></page></image-settings></fix-orientation><page-split defaultLayoutType="auto-detect"><image id="3" layoutType="single-uncut"><params mode="auto"><pages type="single-uncut"><outline><point x="0" y="0"/><point x="7016" y="0"/><point x="7016" y="4961"/><point x="0" y="4961"/><point x="0" y="0"/></outline></pages><dependencies><rotation degrees="0"/><size height="4961" width="7016"/><layoutType>single-uncut</layoutType></dependencies></params></image></page-split><deskew><page id="4"><params angle="0.125" mode="auto"><dependencies><rotation degrees="0"/><page-outline><point x="0" y="0"/><point x="7016" y="0"/><point x="7016" y="4961"/><point x="0" y="4961"/><point x="0" y="0"/></page-outline></dependencies></params></page><image-settings><page id="4"><image-params blackOnWhite="1" bwThreshold="193"/></page></image-settings></deskew><select-content pageDetectionTolerance="0.1"><page id="4"><params contentDetectionMode="auto" fineTuneCorners="0" pageDetectionMode="disabled"><content-rect height="3384" width="2260" x="344" y="388"/><page-rect height="4976.294719097549" width="7026.806517602445" x="0" y="0"/><content-size-mm height="143.256286512573" width="95.6735246803827"/><dependencies><rotated-page-outline><point x="10.82321443814471" y="0"/><point x="7026.806517602445" y="15.30652539770678"/><point x="7015.9833031643" y="4976.294719097549"/><point x="0" y="4960.988193699843"/><point x="10.82321443814471" y="0"/></rotated-page-outline><params contentDetectionMode="auto" fineTuneCorners="0" pageDetectionMode="disabled"/></dependencies></params></page></select-content><page-layout showMiddleRect="1"><page id="4"><params autoMargins="0"><hardMarginsMM bottom="5" left="10" right="10" top="5"/><pageRect height="4976.294719097549" width="7026.806517602445" x="0" y="0"/><contentRect height="3384" width="2260" x="344" y="388"/><contentSizeMM height="143.256286512573" width="95.6735246803827"/><alignment hor="center" null="0" vert="center"/></params></page></page-layout><output><page id="4"><zones/><fill-zones/><params blackOnWhite="1" depthPerception="2" despeckleLevel="1"><picture-shape-options higherSearchSensitivity="0" pictureShape="free" sensitivity="100"/><dewarping-options mode="off" postDeskew="1" postDeskewAngle="0"/><dpi horizontal="600" vertical="600"/><color-params colorMode="colorOrGray"><color-or-grayscale fillMargins="1" fillOffcut="1" fillingColor="background" normalizeIlluminationColor="0"><posterization-options enabled="0" forceBlackAndWhite="1" level="4" normalizationEnabled="0"/></color-or-grayscale><bw binarizationMethod="otsu" morphologicalSmoothing="1" normalizeIlluminationBW="1" sauvolaCoef="0.34" savitzkyGolaySmoothing="1" thresholdAdj="0" windowSize="200" wolfCoef="0.3" wolfLowerBound="1" wolfUpperBound="254"><color-segmenter-options blueThresholdAdjustment="0" enabled="0" greenThresholdAdjustment="0" noiseReduction="7" redThresholdAdjustment="0"/></bw></color-params><splitting originalBackground="0" splitOutput="0" splittingMode="bw"/></params><processing-params autoZonesFound="0" blackOnWhiteSetManually="0"/><output-params><image blackOnWhite="1" depthPerception="2" despeckleLevel="1"><size height="3620" width="2732"/><content-rect height="3384" width="2260" x="236" y="118"/><crop-area><point x="-97.17678556185528" y="-270"/><point x="6918.806517602445" y="-254.6934746022932"/><point x="6907.9833031643" y="4706.294719097549"/><point x="-108" y="4690.988193699843"/><point x="-97.17678556185528" y="-270"/></crop-area><partial-xform><m11>0.9999976201773518</m11><m12>0.00218165983433677</m12><m21>-0.00218165983433677</m21><m22>0.9999976201773518</m22></partial-xform><dpi horizontal="600" vertical="600"/><color-params colorMode="colorOrGray"><color-or-grayscale fillMargins="1" fillOffcut="1" fillingColor="background" normalizeIlluminationColor="0"><posterization-options enabled="0" forceBlackAndWhite="1" level="4" normalizationEnabled="0"/></color-or-grayscale><bw binarizationMethod="otsu" morphologicalSmoothing="1" normalizeIlluminationBW="1" sauvolaCoef="0.34" savitzkyGolaySmoothing="1" thresholdAdj="0" windowSize="200" wolfCoef="0.3" wolfLowerBound="1" wolfUpperBound="254"><color-segmenter-options blueThresholdAdjustment="0" enabled="0" greenThresholdAdjustment="0" noiseReduction="7" redThresholdAdjustment="0"/></bw></color-params><splitting originalBackground="0" splitOutput="0" splittingMode="bw"/><picture-shape-options higherSearchSensitivity="0" pictureShape="free" sensitivity="100"/><dewarping-options mode="off" postDeskew="1" postDeskewAngle="0"/><processing-params autoZonesFound="0" blackOnWhiteSetManually="0"/></image><source_file mtime="1698783384" size="2890349"/><file mtime="1699418600" size="14140884"/><zones/><fill-zones/></output-params></page></output></filters></project>"#;
        const MIXED: &str = r#"<project layoutDirection="LTR" outputDirectory="/home/ramzi/src/bill-organizer/out" version="3"><directories><directory id="1" path="/home/ramzi/src/bill-organizer"/></directories><files><file dirId="1" id="2" name="in.jpg"/></files><images><image fileId="2" fileImage="0" id="3" subPages="1"><size height="4961" width="7016"/><dpi horizontal="600" vertical="600"/></image></images><pages><page id="4" imageId="3" selected="selected" subPage="single"/></pages><file-name-disambiguation><mapping file="2" label="0"/></file-name-disambiguation><filters><fix-orientation><image-settings><page id="4"><image-params blackOnWhite="1" bwThreshold="193"/></page></image-settings></fix-orientation><page-split defaultLayoutType="auto-detect"><image id="3" layoutType="single-uncut"><params mode="auto"><pages type="single-uncut"><outline><point x="0" y="0"/><point x="7016" y="0"/><point x="7016" y="4961"/><point x="0" y="4961"/><point x="0" y="0"/></outline></pages><dependencies><rotation degrees="0"/><size height="4961" width="7016"/><layoutType>single-uncut</layoutType></dependencies></params></image></page-split><deskew><page id="4"><params angle="0.125" mode="auto"><dependencies><rotation degrees="0"/><page-outline><point x="0" y="0"/><point x="7016" y="0"/><point x="7016" y="4961"/><point x="0" y="4961"/><point x="0" y="0"/></page-outline></dependencies></params></page><image-settings><page id="4"><image-params blackOnWhite="1" bwThreshold="193"/></page></image-settings></deskew><select-content pageDetectionTolerance="0.1"><page id="4"><params contentDetectionMode="auto" fineTuneCorners="0" pageDetectionMode="disabled"><content-rect height="3384" width="2260" x="344" y="388"/><page-rect height="4976.294719097549" width="7026.806517602445" x="0" y="0"/><content-size-mm height="143.256286512573" width="95.6735246803827"/><dependencies><rotated-page-outline><point x="10.82321443814471" y="0"/><point x="7026.806517602445" y="15.30652539770678"/><point x="7015.9833031643" y="4976.294719097549"/><point x="0" y="4960.988193699843"/><point x="10.82321443814471" y="0"/></rotated-page-outline><params contentDetectionMode="auto" fineTuneCorners="0" pageDetectionMode="disabled"/></dependencies></params></page></select-content><page-layout showMiddleRect="1"><page id="4"><params autoMargins="0"><hardMarginsMM bottom="5" left="10" right="10" top="5"/><pageRect height="4976.294719097549" width="7026.806517602445" x="0" y="0"/><contentRect height="3384" width="2260" x="344" y="388"/><contentSizeMM height="143.256286512573" width="95.6735246803827"/><alignment hor="center" null="0" vert="center"/></params></page></page-layout><output><page id="4"><zones/><fill-zones/><params blackOnWhite="1" depthPerception="2" despeckleLevel="1"><picture-shape-options higherSearchSensitivity="0" pictureShape="free" sensitivity="100"/><dewarping-options mode="off" postDeskew="1" postDeskewAngle="0"/><dpi horizontal="600" vertical="600"/><color-params colorMode="mixed"><color-or-grayscale fillMargins="1" fillOffcut="1" fillingColor="background" normalizeIlluminationColor="0"><posterization-options enabled="0" forceBlackAndWhite="1" level="4" normalizationEnabled="0"/></color-or-grayscale><bw binarizationMethod="otsu" morphologicalSmoothing="1" normalizeIlluminationBW="1" sauvolaCoef="0.34" savitzkyGolaySmoothing="1" thresholdAdj="0" windowSize="200" wolfCoef="0.3" wolfLowerBound="1" wolfUpperBound="254"><color-segmenter-options blueThresholdAdjustment="0" enabled="0" greenThresholdAdjustment="0" noiseReduction="7" redThresholdAdjustment="0"/></bw></color-params><splitting originalBackground="0" splitOutput="0" splittingMode="bw"/></params><processing-params autoZonesFound="0" blackOnWhiteSetManually="0"/><output-params><image blackOnWhite="1" depthPerception="2" despeckleLevel="1"><size height="3620" width="2732"/><content-rect height="3384" width="2260" x="236" y="118"/><crop-area><point x="-97.17678556185528" y="-270"/><point x="6918.806517602445" y="-254.6934746022932"/><point x="6907.9833031643" y="4706.294719097549"/><point x="-108" y="4690.988193699843"/><point x="-97.17678556185528" y="-270"/></crop-area><partial-xform><m11>0.9999976201773518</m11><m12>0.00218165983433677</m12><m21>-0.00218165983433677</m21><m22>0.9999976201773518</m22></partial-xform><dpi horizontal="600" vertical="600"/><color-params colorMode="mixed"><color-or-grayscale fillMargins="1" fillOffcut="1" fillingColor="background" normalizeIlluminationColor="0"><posterization-options enabled="0" forceBlackAndWhite="1" level="4" normalizationEnabled="0"/></color-or-grayscale><bw binarizationMethod="otsu" morphologicalSmoothing="1" normalizeIlluminationBW="1" sauvolaCoef="0.34" savitzkyGolaySmoothing="1" thresholdAdj="0" windowSize="200" wolfCoef="0.3" wolfLowerBound="1" wolfUpperBound="254"><color-segmenter-options blueThresholdAdjustment="0" enabled="0" greenThresholdAdjustment="0" noiseReduction="7" redThresholdAdjustment="0"/></bw></color-params><splitting originalBackground="0" splitOutput="0" splittingMode="bw"/><picture-shape-options higherSearchSensitivity="0" pictureShape="free" sensitivity="100"/><dewarping-options mode="off" postDeskew="1" postDeskewAngle="0"/><processing-params autoZonesFound="0" blackOnWhiteSetManually="0"/></image><source_file mtime="1698783384" size="2890349"/><file mtime="1699418618" size="151968"/><automask mtime="1699418618" size="1100"/><speckles mtime="1699418618" size="712"/><zones/><fill-zones/></output-params></page></output></filters></project>"#;

        for (content, expected_mode) in [
            (BLACK_AND_WHITE, ColorMode::BlackAndWhite),
            (COLOR_OR_GRAYSCALE, ColorMode::ColorOrGrayscale),
            (MIXED, ColorMode::Mixed),
        ] {
            let color_params = get_color_params(content);
            assert_eq!(color_params.color_mode, expected_mode);
        }
    }

    #[test]
    fn it_deserializes_filling_color() {
        const BACKGROUND: &str = r#"<project layoutDirection="LTR" outputDirectory="/home/ramzi/src/bill-organizer/out" version="3"><directories><directory id="1" path="/home/ramzi/src/bill-organizer"/></directories><files><file dirId="1" id="2" name="in.jpg"/></files><images><image fileId="2" fileImage="0" id="3" subPages="1"><size height="4961" width="7016"/><dpi horizontal="600" vertical="600"/></image></images><pages><page id="4" imageId="3" selected="selected" subPage="single"/></pages><file-name-disambiguation><mapping file="2" label="0"/></file-name-disambiguation><filters><fix-orientation><image-settings><page id="4"><image-params blackOnWhite="1" bwThreshold="193"/></page></image-settings></fix-orientation><page-split defaultLayoutType="auto-detect"><image id="3" layoutType="single-uncut"><params mode="auto"><pages type="single-uncut"><outline><point x="0" y="0"/><point x="7016" y="0"/><point x="7016" y="4961"/><point x="0" y="4961"/><point x="0" y="0"/></outline></pages><dependencies><rotation degrees="0"/><size height="4961" width="7016"/><layoutType>single-uncut</layoutType></dependencies></params></image></page-split><deskew><page id="4"><params angle="0.125" mode="auto"><dependencies><rotation degrees="0"/><page-outline><point x="0" y="0"/><point x="7016" y="0"/><point x="7016" y="4961"/><point x="0" y="4961"/><point x="0" y="0"/></page-outline></dependencies></params></page><image-settings><page id="4"><image-params blackOnWhite="1" bwThreshold="193"/></page></image-settings></deskew><select-content pageDetectionTolerance="0.1"><page id="4"><params contentDetectionMode="auto" fineTuneCorners="0" pageDetectionMode="disabled"><content-rect height="3384" width="2260" x="344" y="388"/><page-rect height="4976.294719097549" width="7026.806517602445" x="0" y="0"/><content-size-mm height="143.256286512573" width="95.6735246803827"/><dependencies><rotated-page-outline><point x="10.82321443814471" y="0"/><point x="7026.806517602445" y="15.30652539770678"/><point x="7015.9833031643" y="4976.294719097549"/><point x="0" y="4960.988193699843"/><point x="10.82321443814471" y="0"/></rotated-page-outline><params contentDetectionMode="auto" fineTuneCorners="0" pageDetectionMode="disabled"/></dependencies></params></page></select-content><page-layout showMiddleRect="1"><page id="4"><params autoMargins="0"><hardMarginsMM bottom="5" left="10" right="10" top="5"/><pageRect height="4976.294719097549" width="7026.806517602445" x="0" y="0"/><contentRect height="3384" width="2260" x="344" y="388"/><contentSizeMM height="143.256286512573" width="95.6735246803827"/><alignment hor="center" null="0" vert="center"/></params></page></page-layout><output><page id="4"><zones/><fill-zones/><params blackOnWhite="1" depthPerception="2" despeckleLevel="1"><picture-shape-options higherSearchSensitivity="0" pictureShape="free" sensitivity="100"/><dewarping-options mode="off" postDeskew="1" postDeskewAngle="0"/><dpi horizontal="600" vertical="600"/><color-params colorMode="colorOrGray"><color-or-grayscale fillMargins="1" fillOffcut="1" fillingColor="background" normalizeIlluminationColor="0"><posterization-options enabled="0" forceBlackAndWhite="1" level="4" normalizationEnabled="0"/></color-or-grayscale><bw binarizationMethod="otsu" morphologicalSmoothing="1" normalizeIlluminationBW="1" sauvolaCoef="0.34" savitzkyGolaySmoothing="1" thresholdAdj="0" windowSize="200" wolfCoef="0.3" wolfLowerBound="1" wolfUpperBound="254"><color-segmenter-options blueThresholdAdjustment="0" enabled="0" greenThresholdAdjustment="0" noiseReduction="7" redThresholdAdjustment="0"/></bw></color-params><splitting originalBackground="0" splitOutput="0" splittingMode="bw"/></params><processing-params autoZonesFound="0" blackOnWhiteSetManually="0"/><output-params><image blackOnWhite="1" depthPerception="2" despeckleLevel="1"><size height="3620" width="2732"/><content-rect height="3384" width="2260" x="236" y="118"/><crop-area><point x="-97.17678556185528" y="-270"/><point x="6918.806517602445" y="-254.6934746022932"/><point x="6907.9833031643" y="4706.294719097549"/><point x="-108" y="4690.988193699843"/><point x="-97.17678556185528" y="-270"/></crop-area><partial-xform><m11>0.9999976201773518</m11><m12>0.00218165983433677</m12><m21>-0.00218165983433677</m21><m22>0.9999976201773518</m22></partial-xform><dpi horizontal="600" vertical="600"/><color-params colorMode="colorOrGray"><color-or-grayscale fillMargins="1" fillOffcut="1" fillingColor="background" normalizeIlluminationColor="0"><posterization-options enabled="0" forceBlackAndWhite="1" level="4" normalizationEnabled="0"/></color-or-grayscale><bw binarizationMethod="otsu" morphologicalSmoothing="1" normalizeIlluminationBW="1" sauvolaCoef="0.34" savitzkyGolaySmoothing="1" thresholdAdj="0" windowSize="200" wolfCoef="0.3" wolfLowerBound="1" wolfUpperBound="254"><color-segmenter-options blueThresholdAdjustment="0" enabled="0" greenThresholdAdjustment="0" noiseReduction="7" redThresholdAdjustment="0"/></bw></color-params><splitting originalBackground="0" splitOutput="0" splittingMode="bw"/><picture-shape-options higherSearchSensitivity="0" pictureShape="free" sensitivity="100"/><dewarping-options mode="off" postDeskew="1" postDeskewAngle="0"/><processing-params autoZonesFound="0" blackOnWhiteSetManually="0"/></image><source_file mtime="1698783384" size="2890349"/><file mtime="1699418819" size="14140884"/><zones/><fill-zones/></output-params></page></output></filters></project>"#;
        const WHITE: &str = r#"<project layoutDirection="LTR" outputDirectory="/home/ramzi/src/bill-organizer/out" version="3"><directories><directory id="1" path="/home/ramzi/src/bill-organizer"/></directories><files><file dirId="1" id="2" name="in.jpg"/></files><images><image fileId="2" fileImage="0" id="3" subPages="1"><size height="4961" width="7016"/><dpi horizontal="600" vertical="600"/></image></images><pages><page id="4" imageId="3" selected="selected" subPage="single"/></pages><file-name-disambiguation><mapping file="2" label="0"/></file-name-disambiguation><filters><fix-orientation><image-settings><page id="4"><image-params blackOnWhite="1" bwThreshold="193"/></page></image-settings></fix-orientation><page-split defaultLayoutType="auto-detect"><image id="3" layoutType="single-uncut"><params mode="auto"><pages type="single-uncut"><outline><point x="0" y="0"/><point x="7016" y="0"/><point x="7016" y="4961"/><point x="0" y="4961"/><point x="0" y="0"/></outline></pages><dependencies><rotation degrees="0"/><size height="4961" width="7016"/><layoutType>single-uncut</layoutType></dependencies></params></image></page-split><deskew><page id="4"><params angle="0.125" mode="auto"><dependencies><rotation degrees="0"/><page-outline><point x="0" y="0"/><point x="7016" y="0"/><point x="7016" y="4961"/><point x="0" y="4961"/><point x="0" y="0"/></page-outline></dependencies></params></page><image-settings><page id="4"><image-params blackOnWhite="1" bwThreshold="193"/></page></image-settings></deskew><select-content pageDetectionTolerance="0.1"><page id="4"><params contentDetectionMode="auto" fineTuneCorners="0" pageDetectionMode="disabled"><content-rect height="3384" width="2260" x="344" y="388"/><page-rect height="4976.294719097549" width="7026.806517602445" x="0" y="0"/><content-size-mm height="143.256286512573" width="95.6735246803827"/><dependencies><rotated-page-outline><point x="10.82321443814471" y="0"/><point x="7026.806517602445" y="15.30652539770678"/><point x="7015.9833031643" y="4976.294719097549"/><point x="0" y="4960.988193699843"/><point x="10.82321443814471" y="0"/></rotated-page-outline><params contentDetectionMode="auto" fineTuneCorners="0" pageDetectionMode="disabled"/></dependencies></params></page></select-content><page-layout showMiddleRect="1"><page id="4"><params autoMargins="0"><hardMarginsMM bottom="5" left="10" right="10" top="5"/><pageRect height="4976.294719097549" width="7026.806517602445" x="0" y="0"/><contentRect height="3384" width="2260" x="344" y="388"/><contentSizeMM height="143.256286512573" width="95.6735246803827"/><alignment hor="center" null="0" vert="center"/></params></page></page-layout><output><page id="4"><zones/><fill-zones/><params blackOnWhite="1" depthPerception="2" despeckleLevel="1"><picture-shape-options higherSearchSensitivity="0" pictureShape="free" sensitivity="100"/><dewarping-options mode="off" postDeskew="1" postDeskewAngle="0"/><dpi horizontal="600" vertical="600"/><color-params colorMode="colorOrGray"><color-or-grayscale fillMargins="1" fillOffcut="1" fillingColor="white" normalizeIlluminationColor="0"><posterization-options enabled="0" forceBlackAndWhite="1" level="4" normalizationEnabled="0"/></color-or-grayscale><bw binarizationMethod="otsu" morphologicalSmoothing="1" normalizeIlluminationBW="1" sauvolaCoef="0.34" savitzkyGolaySmoothing="1" thresholdAdj="0" windowSize="200" wolfCoef="0.3" wolfLowerBound="1" wolfUpperBound="254"><color-segmenter-options blueThresholdAdjustment="0" enabled="0" greenThresholdAdjustment="0" noiseReduction="7" redThresholdAdjustment="0"/></bw></color-params><splitting originalBackground="0" splitOutput="0" splittingMode="bw"/></params><processing-params autoZonesFound="0" blackOnWhiteSetManually="0"/><output-params><image blackOnWhite="1" depthPerception="2" despeckleLevel="1"><size height="3620" width="2732"/><content-rect height="3384" width="2260" x="236" y="118"/><crop-area><point x="-97.17678556185528" y="-270"/><point x="6918.806517602445" y="-254.6934746022932"/><point x="6907.9833031643" y="4706.294719097549"/><point x="-108" y="4690.988193699843"/><point x="-97.17678556185528" y="-270"/></crop-area><partial-xform><m11>0.9999976201773518</m11><m12>0.00218165983433677</m12><m21>-0.00218165983433677</m21><m22>0.9999976201773518</m22></partial-xform><dpi horizontal="600" vertical="600"/><color-params colorMode="colorOrGray"><color-or-grayscale fillMargins="1" fillOffcut="1" fillingColor="white" normalizeIlluminationColor="0"><posterization-options enabled="0" forceBlackAndWhite="1" level="4" normalizationEnabled="0"/></color-or-grayscale><bw binarizationMethod="otsu" morphologicalSmoothing="1" normalizeIlluminationBW="1" sauvolaCoef="0.34" savitzkyGolaySmoothing="1" thresholdAdj="0" windowSize="200" wolfCoef="0.3" wolfLowerBound="1" wolfUpperBound="254"><color-segmenter-options blueThresholdAdjustment="0" enabled="0" greenThresholdAdjustment="0" noiseReduction="7" redThresholdAdjustment="0"/></bw></color-params><splitting originalBackground="0" splitOutput="0" splittingMode="bw"/><picture-shape-options higherSearchSensitivity="0" pictureShape="free" sensitivity="100"/><dewarping-options mode="off" postDeskew="1" postDeskewAngle="0"/><processing-params autoZonesFound="0" blackOnWhiteSetManually="0"/></image><source_file mtime="1698783384" size="2890349"/><file mtime="1699418856" size="14012450"/><zones/><fill-zones/></output-params></page></output></filters></project>"#;
        const BLACK: &str = r#"<project layoutDirection="LTR" outputDirectory="/home/ramzi/src/bill-organizer/out" version="3"><directories><directory id="1" path="/home/ramzi/src/bill-organizer"/></directories><files><file dirId="1" id="2" name="in.jpg"/></files><images><image fileId="2" fileImage="0" id="3" subPages="1"><size height="4961" width="7016"/><dpi horizontal="600" vertical="600"/></image></images><pages><page id="4" imageId="3" selected="selected" subPage="single"/></pages><file-name-disambiguation><mapping file="2" label="0"/></file-name-disambiguation><filters><fix-orientation><image-settings><page id="4"><image-params blackOnWhite="1" bwThreshold="193"/></page></image-settings></fix-orientation><page-split defaultLayoutType="auto-detect"><image id="3" layoutType="single-uncut"><params mode="auto"><pages type="single-uncut"><outline><point x="0" y="0"/><point x="7016" y="0"/><point x="7016" y="4961"/><point x="0" y="4961"/><point x="0" y="0"/></outline></pages><dependencies><rotation degrees="0"/><size height="4961" width="7016"/><layoutType>single-uncut</layoutType></dependencies></params></image></page-split><deskew><page id="4"><params angle="0.125" mode="auto"><dependencies><rotation degrees="0"/><page-outline><point x="0" y="0"/><point x="7016" y="0"/><point x="7016" y="4961"/><point x="0" y="4961"/><point x="0" y="0"/></page-outline></dependencies></params></page><image-settings><page id="4"><image-params blackOnWhite="1" bwThreshold="193"/></page></image-settings></deskew><select-content pageDetectionTolerance="0.1"><page id="4"><params contentDetectionMode="auto" fineTuneCorners="0" pageDetectionMode="disabled"><content-rect height="3384" width="2260" x="344" y="388"/><page-rect height="4976.294719097549" width="7026.806517602445" x="0" y="0"/><content-size-mm height="143.256286512573" width="95.6735246803827"/><dependencies><rotated-page-outline><point x="10.82321443814471" y="0"/><point x="7026.806517602445" y="15.30652539770678"/><point x="7015.9833031643" y="4976.294719097549"/><point x="0" y="4960.988193699843"/><point x="10.82321443814471" y="0"/></rotated-page-outline><params contentDetectionMode="auto" fineTuneCorners="0" pageDetectionMode="disabled"/></dependencies></params></page></select-content><page-layout showMiddleRect="1"><page id="4"><params autoMargins="0"><hardMarginsMM bottom="5" left="10" right="10" top="5"/><pageRect height="4976.294719097549" width="7026.806517602445" x="0" y="0"/><contentRect height="3384" width="2260" x="344" y="388"/><contentSizeMM height="143.256286512573" width="95.6735246803827"/><alignment hor="center" null="0" vert="center"/></params></page></page-layout><output><page id="4"><zones/><fill-zones/><params blackOnWhite="1" depthPerception="2" despeckleLevel="1"><picture-shape-options higherSearchSensitivity="0" pictureShape="free" sensitivity="100"/><dewarping-options mode="off" postDeskew="1" postDeskewAngle="0"/><dpi horizontal="600" vertical="600"/><color-params colorMode="colorOrGray"><color-or-grayscale fillMargins="1" fillOffcut="1" fillingColor="black" normalizeIlluminationColor="0"><posterization-options enabled="0" forceBlackAndWhite="1" level="4" normalizationEnabled="0"/></color-or-grayscale><bw binarizationMethod="otsu" morphologicalSmoothing="1" normalizeIlluminationBW="1" sauvolaCoef="0.34" savitzkyGolaySmoothing="1" thresholdAdj="0" windowSize="200" wolfCoef="0.3" wolfLowerBound="1" wolfUpperBound="254"><color-segmenter-options blueThresholdAdjustment="0" enabled="0" greenThresholdAdjustment="0" noiseReduction="7" redThresholdAdjustment="0"/></bw></color-params><splitting originalBackground="0" splitOutput="0" splittingMode="bw"/></params><processing-params autoZonesFound="0" blackOnWhiteSetManually="0"/><output-params><image blackOnWhite="1" depthPerception="2" despeckleLevel="1"><size height="3620" width="2732"/><content-rect height="3384" width="2260" x="236" y="118"/><crop-area><point x="-97.17678556185528" y="-270"/><point x="6918.806517602445" y="-254.6934746022932"/><point x="6907.9833031643" y="4706.294719097549"/><point x="-108" y="4690.988193699843"/><point x="-97.17678556185528" y="-270"/></crop-area><partial-xform><m11>0.9999976201773518</m11><m12>0.00218165983433677</m12><m21>-0.00218165983433677</m21><m22>0.9999976201773518</m22></partial-xform><dpi horizontal="600" vertical="600"/><color-params colorMode="colorOrGray"><color-or-grayscale fillMargins="1" fillOffcut="1" fillingColor="black" normalizeIlluminationColor="0"><posterization-options enabled="0" forceBlackAndWhite="1" level="4" normalizationEnabled="0"/></color-or-grayscale><bw binarizationMethod="otsu" morphologicalSmoothing="1" normalizeIlluminationBW="1" sauvolaCoef="0.34" savitzkyGolaySmoothing="1" thresholdAdj="0" windowSize="200" wolfCoef="0.3" wolfLowerBound="1" wolfUpperBound="254"><color-segmenter-options blueThresholdAdjustment="0" enabled="0" greenThresholdAdjustment="0" noiseReduction="7" redThresholdAdjustment="0"/></bw></color-params><splitting originalBackground="0" splitOutput="0" splittingMode="bw"/><picture-shape-options higherSearchSensitivity="0" pictureShape="free" sensitivity="100"/><dewarping-options mode="off" postDeskew="1" postDeskewAngle="0"/><processing-params autoZonesFound="0" blackOnWhiteSetManually="0"/></image><source_file mtime="1698783384" size="2890349"/><file mtime="1699418876" size="14016766"/><zones/><fill-zones/></output-params></page></output></filters></project>"#;

        for (content, expected_color) in [
            (BACKGROUND, FillingColor::Background),
            (WHITE, FillingColor::White),
            (BLACK, FillingColor::Black),
        ] {
            let color_params = get_color_params(content);
            assert_eq!(
                color_params.color_or_grayscale.filling_color,
                expected_color
            );
        }
    }

    #[test]
    fn it_deserializes_binarization_method() {
        const OTSU: &str = r#"<project layoutDirection="LTR" outputDirectory="/home/ramzi/src/bill-organizer/out" version="3"><directories><directory id="1" path="/home/ramzi/src/bill-organizer" /></directories><files><file dirId="1" id="2" name="in.jpg" /></files><images><image fileId="2" fileImage="0" id="3" subPages="1"><size height="4961" width="7016" /><dpi horizontal="600" vertical="600" /></image></images><pages><page id="4" imageId="3" selected="selected" subPage="single" /></pages><file-name-disambiguation><mapping file="2" label="0" /></file-name-disambiguation><filters><fix-orientation><image-settings><page id="4"><image-params blackOnWhite="1" bwThreshold="193" /></page></image-settings></fix-orientation><page-split defaultLayoutType="auto-detect"><image id="3" layoutType="single-uncut"><params mode="auto"><pages type="single-uncut"><outline><point x="0" y="0" /><point x="7016" y="0" /><point x="7016" y="4961" /><point x="0" y="4961" /><point x="0" y="0" /></outline></pages><dependencies><rotation degrees="0" /><size height="4961" width="7016" /><layoutType>single-uncut</layoutType></dependencies></params></image></page-split><deskew><page id="4"><params angle="0" mode="auto"><dependencies><rotation degrees="0" /><page-outline /></dependencies></params></page><image-settings /></deskew><select-content pageDetectionTolerance="0.1"><page id="4"><params contentDetectionMode="auto" fineTuneCorners="0" pageDetectionMode="disabled"><content-rect height="0" width="0" x="0" y="0" /><page-rect height="7015.733999999999" width="4960.62" x="0" y="0" /><content-size-mm height="-1" width="-1" /><dependencies><rotated-page-outline /><params contentDetectionMode="auto" fineTuneCorners="0" pageDetectionMode="disabled" /></dependencies></params></page></select-content><page-layout showMiddleRect="1"><page id="4"><params autoMargins="0"><hardMarginsMM bottom="5" left="10" right="10" top="5" /><pageRect height="0" width="0" x="0" y="0" /><contentRect height="0" width="0" x="0" y="0" /><contentSizeMM height="-1" width="-1" /><alignment hor="center" null="0" vert="center" /></params></page></page-layout><output><page id="4"><zones /><fill-zones /><params blackOnWhite="1" depthPerception="2" despeckleLevel="1"><picture-shape-options higherSearchSensitivity="0" pictureShape="free" sensitivity="100" /><dewarping-options mode="off" postDeskew="1" postDeskewAngle="0" /><dpi horizontal="600" vertical="600" /><color-params colorMode="bw"><color-or-grayscale fillMargins="1" fillOffcut="1" fillingColor="background" normalizeIlluminationColor="0"><posterization-options enabled="0" forceBlackAndWhite="1" level="4" normalizationEnabled="0" /></color-or-grayscale><bw binarizationMethod="otsu" morphologicalSmoothing="1" normalizeIlluminationBW="1" sauvolaCoef="0.34" savitzkyGolaySmoothing="1" thresholdAdj="0" windowSize="200" wolfCoef="0.3" wolfLowerBound="1" wolfUpperBound="254"><color-segmenter-options blueThresholdAdjustment="0" enabled="0" greenThresholdAdjustment="0" noiseReduction="7" redThresholdAdjustment="0" /></bw></color-params><splitting originalBackground="0" splitOutput="0" splittingMode="bw" /></params><processing-params autoZonesFound="0" blackOnWhiteSetManually="0" /></page></output></filters></project>"#;
        const SAUVOLA: &str = r#"<project layoutDirection="LTR" outputDirectory="/home/ramzi/src/bill-organizer/out" version="3"><directories><directory id="1" path="/home/ramzi/src/bill-organizer"/></directories><files><file dirId="1" id="2" name="in.jpg"/></files><images><image fileId="2" fileImage="0" id="3" subPages="1"><size height="4961" width="7016"/><dpi horizontal="600" vertical="600"/></image></images><pages><page id="4" imageId="3" selected="selected" subPage="single"/></pages><file-name-disambiguation><mapping file="2" label="0"/></file-name-disambiguation><filters><fix-orientation><image-settings><page id="4"><image-params blackOnWhite="1" bwThreshold="193"/></page></image-settings></fix-orientation><page-split defaultLayoutType="auto-detect"><image id="3" layoutType="single-uncut"><params mode="auto"><pages type="single-uncut"><outline><point x="0" y="0"/><point x="7016" y="0"/><point x="7016" y="4961"/><point x="0" y="4961"/><point x="0" y="0"/></outline></pages><dependencies><rotation degrees="0"/><size height="4961" width="7016"/><layoutType>single-uncut</layoutType></dependencies></params></image></page-split><deskew><page id="4"><params angle="0.125" mode="auto"><dependencies><rotation degrees="0"/><page-outline><point x="0" y="0"/><point x="7016" y="0"/><point x="7016" y="4961"/><point x="0" y="4961"/><point x="0" y="0"/></page-outline></dependencies></params></page><image-settings><page id="4"><image-params blackOnWhite="1" bwThreshold="193"/></page></image-settings></deskew><select-content pageDetectionTolerance="0.1"><page id="4"><params contentDetectionMode="auto" fineTuneCorners="0" pageDetectionMode="disabled"><content-rect height="3384" width="2260" x="344" y="388"/><page-rect height="4976.294719097549" width="7026.806517602445" x="0" y="0"/><content-size-mm height="143.256286512573" width="95.6735246803827"/><dependencies><rotated-page-outline><point x="10.82321443814471" y="0"/><point x="7026.806517602445" y="15.30652539770678"/><point x="7015.9833031643" y="4976.294719097549"/><point x="0" y="4960.988193699843"/><point x="10.82321443814471" y="0"/></rotated-page-outline><params contentDetectionMode="auto" fineTuneCorners="0" pageDetectionMode="disabled"/></dependencies></params></page></select-content><page-layout showMiddleRect="1"><page id="4"><params autoMargins="0"><hardMarginsMM bottom="5" left="10" right="10" top="5"/><pageRect height="4976.294719097549" width="7026.806517602445" x="0" y="0"/><contentRect height="3384" width="2260" x="344" y="388"/><contentSizeMM height="143.256286512573" width="95.6735246803827"/><alignment hor="center" null="0" vert="center"/></params></page></page-layout><output><page id="4"><zones/><fill-zones/><params blackOnWhite="1" depthPerception="2" despeckleLevel="1"><picture-shape-options higherSearchSensitivity="0" pictureShape="free" sensitivity="100"/><dewarping-options mode="off" postDeskew="1" postDeskewAngle="0"/><dpi horizontal="600" vertical="600"/><color-params colorMode="bw"><color-or-grayscale fillMargins="1" fillOffcut="1" fillingColor="background" normalizeIlluminationColor="0"><posterization-options enabled="0" forceBlackAndWhite="1" level="4" normalizationEnabled="0"/></color-or-grayscale><bw binarizationMethod="sauvola" morphologicalSmoothing="1" normalizeIlluminationBW="1" sauvolaCoef="0.34" savitzkyGolaySmoothing="1" thresholdAdj="0" windowSize="200" wolfCoef="0.3" wolfLowerBound="1" wolfUpperBound="254"><color-segmenter-options blueThresholdAdjustment="0" enabled="0" greenThresholdAdjustment="0" noiseReduction="7" redThresholdAdjustment="0"/></bw></color-params><splitting originalBackground="0" splitOutput="0" splittingMode="bw"/></params><processing-params autoZonesFound="0" blackOnWhiteSetManually="0"/><output-params><image blackOnWhite="1" depthPerception="2" despeckleLevel="1"><size height="3620" width="2732"/><content-rect height="3384" width="2260" x="236" y="118"/><crop-area><point x="-97.17678556185528" y="-270"/><point x="6918.806517602445" y="-254.6934746022932"/><point x="6907.9833031643" y="4706.294719097549"/><point x="-108" y="4690.988193699843"/><point x="-97.17678556185528" y="-270"/></crop-area><partial-xform><m11>0.9999976201773518</m11><m12>0.00218165983433677</m12><m21>-0.00218165983433677</m21><m22>0.9999976201773518</m22></partial-xform><dpi horizontal="600" vertical="600"/><color-params colorMode="bw"><color-or-grayscale fillMargins="1" fillOffcut="1" fillingColor="background" normalizeIlluminationColor="0"><posterization-options enabled="0" forceBlackAndWhite="1" level="4" normalizationEnabled="0"/></color-or-grayscale><bw binarizationMethod="sauvola" morphologicalSmoothing="1" normalizeIlluminationBW="1" sauvolaCoef="0.34" savitzkyGolaySmoothing="1" thresholdAdj="0" windowSize="200" wolfCoef="0.3" wolfLowerBound="1" wolfUpperBound="254"><color-segmenter-options blueThresholdAdjustment="0" enabled="0" greenThresholdAdjustment="0" noiseReduction="7" redThresholdAdjustment="0"/></bw></color-params><splitting originalBackground="0" splitOutput="0" splittingMode="bw"/><picture-shape-options higherSearchSensitivity="0" pictureShape="free" sensitivity="100"/><dewarping-options mode="off" postDeskew="1" postDeskewAngle="0"/><processing-params autoZonesFound="0" blackOnWhiteSetManually="0"/></image><source_file mtime="1698783384" size="2890349"/><file mtime="1699419087" size="26544"/><speckles mtime="1699419087" size="654"/><zones/><fill-zones/></output-params></page></output></filters></project>"#;
        const WOLF: &str = r#"<project layoutDirection="LTR" outputDirectory="/home/ramzi/src/bill-organizer/out" version="3"><directories><directory id="1" path="/home/ramzi/src/bill-organizer"/></directories><files><file dirId="1" id="2" name="in.jpg"/></files><images><image fileId="2" fileImage="0" id="3" subPages="1"><size height="4961" width="7016"/><dpi horizontal="600" vertical="600"/></image></images><pages><page id="4" imageId="3" selected="selected" subPage="single"/></pages><file-name-disambiguation><mapping file="2" label="0"/></file-name-disambiguation><filters><fix-orientation><image-settings><page id="4"><image-params blackOnWhite="1" bwThreshold="193"/></page></image-settings></fix-orientation><page-split defaultLayoutType="auto-detect"><image id="3" layoutType="single-uncut"><params mode="auto"><pages type="single-uncut"><outline><point x="0" y="0"/><point x="7016" y="0"/><point x="7016" y="4961"/><point x="0" y="4961"/><point x="0" y="0"/></outline></pages><dependencies><rotation degrees="0"/><size height="4961" width="7016"/><layoutType>single-uncut</layoutType></dependencies></params></image></page-split><deskew><page id="4"><params angle="0.125" mode="auto"><dependencies><rotation degrees="0"/><page-outline><point x="0" y="0"/><point x="7016" y="0"/><point x="7016" y="4961"/><point x="0" y="4961"/><point x="0" y="0"/></page-outline></dependencies></params></page><image-settings><page id="4"><image-params blackOnWhite="1" bwThreshold="193"/></page></image-settings></deskew><select-content pageDetectionTolerance="0.1"><page id="4"><params contentDetectionMode="auto" fineTuneCorners="0" pageDetectionMode="disabled"><content-rect height="3384" width="2260" x="344" y="388"/><page-rect height="4976.294719097549" width="7026.806517602445" x="0" y="0"/><content-size-mm height="143.256286512573" width="95.6735246803827"/><dependencies><rotated-page-outline><point x="10.82321443814471" y="0"/><point x="7026.806517602445" y="15.30652539770678"/><point x="7015.9833031643" y="4976.294719097549"/><point x="0" y="4960.988193699843"/><point x="10.82321443814471" y="0"/></rotated-page-outline><params contentDetectionMode="auto" fineTuneCorners="0" pageDetectionMode="disabled"/></dependencies></params></page></select-content><page-layout showMiddleRect="1"><page id="4"><params autoMargins="0"><hardMarginsMM bottom="5" left="10" right="10" top="5"/><pageRect height="4976.294719097549" width="7026.806517602445" x="0" y="0"/><contentRect height="3384" width="2260" x="344" y="388"/><contentSizeMM height="143.256286512573" width="95.6735246803827"/><alignment hor="center" null="0" vert="center"/></params></page></page-layout><output><page id="4"><zones/><fill-zones/><params blackOnWhite="1" depthPerception="2" despeckleLevel="1"><picture-shape-options higherSearchSensitivity="0" pictureShape="free" sensitivity="100"/><dewarping-options mode="off" postDeskew="1" postDeskewAngle="0"/><dpi horizontal="600" vertical="600"/><color-params colorMode="bw"><color-or-grayscale fillMargins="1" fillOffcut="1" fillingColor="background" normalizeIlluminationColor="0"><posterization-options enabled="0" forceBlackAndWhite="1" level="4" normalizationEnabled="0"/></color-or-grayscale><bw binarizationMethod="wolf" morphologicalSmoothing="1" normalizeIlluminationBW="1" sauvolaCoef="0.34" savitzkyGolaySmoothing="1" thresholdAdj="0" windowSize="200" wolfCoef="0.3" wolfLowerBound="1" wolfUpperBound="254"><color-segmenter-options blueThresholdAdjustment="0" enabled="0" greenThresholdAdjustment="0" noiseReduction="7" redThresholdAdjustment="0"/></bw></color-params><splitting originalBackground="0" splitOutput="0" splittingMode="bw"/></params><processing-params autoZonesFound="0" blackOnWhiteSetManually="0"/><output-params><image blackOnWhite="1" depthPerception="2" despeckleLevel="1"><size height="3620" width="2732"/><content-rect height="3384" width="2260" x="236" y="118"/><crop-area><point x="-97.17678556185528" y="-270"/><point x="6918.806517602445" y="-254.6934746022932"/><point x="6907.9833031643" y="4706.294719097549"/><point x="-108" y="4690.988193699843"/><point x="-97.17678556185528" y="-270"/></crop-area><partial-xform><m11>0.9999976201773518</m11><m12>0.00218165983433677</m12><m21>-0.00218165983433677</m21><m22>0.9999976201773518</m22></partial-xform><dpi horizontal="600" vertical="600"/><color-params colorMode="bw"><color-or-grayscale fillMargins="1" fillOffcut="1" fillingColor="background" normalizeIlluminationColor="0"><posterization-options enabled="0" forceBlackAndWhite="1" level="4" normalizationEnabled="0"/></color-or-grayscale><bw binarizationMethod="wolf" morphologicalSmoothing="1" normalizeIlluminationBW="1" sauvolaCoef="0.34" savitzkyGolaySmoothing="1" thresholdAdj="0" windowSize="200" wolfCoef="0.3" wolfLowerBound="1" wolfUpperBound="254"><color-segmenter-options blueThresholdAdjustment="0" enabled="0" greenThresholdAdjustment="0" noiseReduction="7" redThresholdAdjustment="0"/></bw></color-params><splitting originalBackground="0" splitOutput="0" splittingMode="bw"/><picture-shape-options higherSearchSensitivity="0" pictureShape="free" sensitivity="100"/><dewarping-options mode="off" postDeskew="1" postDeskewAngle="0"/><processing-params autoZonesFound="0" blackOnWhiteSetManually="0"/></image><source_file mtime="1698783384" size="2890349"/><file mtime="1699419332" size="26728"/><speckles mtime="1699419332" size="710"/><zones/><fill-zones/></output-params></page></output></filters></project>"#;
        const EDGE_PLUS: &str = r#"<project layoutDirection="LTR" outputDirectory="/home/ramzi/src/bill-organizer/out" version="3"><directories><directory id="1" path="/home/ramzi/src/bill-organizer"/></directories><files><file dirId="1" id="2" name="in.jpg"/></files><images><image fileId="2" fileImage="0" id="3" subPages="1"><size height="4961" width="7016"/><dpi horizontal="600" vertical="600"/></image></images><pages><page id="4" imageId="3" selected="selected" subPage="single"/></pages><file-name-disambiguation><mapping file="2" label="0"/></file-name-disambiguation><filters><fix-orientation><image-settings><page id="4"><image-params blackOnWhite="1" bwThreshold="193"/></page></image-settings></fix-orientation><page-split defaultLayoutType="auto-detect"><image id="3" layoutType="single-uncut"><params mode="auto"><pages type="single-uncut"><outline><point x="0" y="0"/><point x="7016" y="0"/><point x="7016" y="4961"/><point x="0" y="4961"/><point x="0" y="0"/></outline></pages><dependencies><rotation degrees="0"/><size height="4961" width="7016"/><layoutType>single-uncut</layoutType></dependencies></params></image></page-split><deskew><page id="4"><params angle="0.125" mode="auto"><dependencies><rotation degrees="0"/><page-outline><point x="0" y="0"/><point x="7016" y="0"/><point x="7016" y="4961"/><point x="0" y="4961"/><point x="0" y="0"/></page-outline></dependencies></params></page><image-settings><page id="4"><image-params blackOnWhite="1" bwThreshold="193"/></page></image-settings></deskew><select-content pageDetectionTolerance="0.1"><page id="4"><params contentDetectionMode="auto" fineTuneCorners="0" pageDetectionMode="disabled"><content-rect height="3384" width="2260" x="344" y="388"/><page-rect height="4976.294719097549" width="7026.806517602445" x="0" y="0"/><content-size-mm height="143.256286512573" width="95.6735246803827"/><dependencies><rotated-page-outline><point x="10.82321443814471" y="0"/><point x="7026.806517602445" y="15.30652539770678"/><point x="7015.9833031643" y="4976.294719097549"/><point x="0" y="4960.988193699843"/><point x="10.82321443814471" y="0"/></rotated-page-outline><params contentDetectionMode="auto" fineTuneCorners="0" pageDetectionMode="disabled"/></dependencies></params></page></select-content><page-layout showMiddleRect="1"><page id="4"><params autoMargins="0"><hardMarginsMM bottom="5" left="10" right="10" top="5"/><pageRect height="4976.294719097549" width="7026.806517602445" x="0" y="0"/><contentRect height="3384" width="2260" x="344" y="388"/><contentSizeMM height="143.256286512573" width="95.6735246803827"/><alignment hor="center" null="0" vert="center"/></params></page></page-layout><output><page id="4"><zones/><fill-zones/><params blackOnWhite="1" depthPerception="2" despeckleLevel="1"><picture-shape-options higherSearchSensitivity="0" pictureShape="free" sensitivity="100"/><dewarping-options mode="off" postDeskew="1" postDeskewAngle="0"/><dpi horizontal="600" vertical="600"/><color-params colorMode="bw"><color-or-grayscale fillMargins="1" fillOffcut="1" fillingColor="background" normalizeIlluminationColor="0"><posterization-options enabled="0" forceBlackAndWhite="1" level="4" normalizationEnabled="0"/></color-or-grayscale><bw binarizationMethod="edgeplus" morphologicalSmoothing="1" normalizeIlluminationBW="1" sauvolaCoef="0.34" savitzkyGolaySmoothing="1" thresholdAdj="0" windowSize="200" wolfCoef="0.3" wolfLowerBound="1" wolfUpperBound="254"><color-segmenter-options blueThresholdAdjustment="0" enabled="0" greenThresholdAdjustment="0" noiseReduction="7" redThresholdAdjustment="0"/></bw></color-params><splitting originalBackground="0" splitOutput="0" splittingMode="bw"/></params><processing-params autoZonesFound="0" blackOnWhiteSetManually="0"/><output-params><image blackOnWhite="1" depthPerception="2" despeckleLevel="1"><size height="3620" width="2732"/><content-rect height="3384" width="2260" x="236" y="118"/><crop-area><point x="-97.17678556185528" y="-270"/><point x="6918.806517602445" y="-254.6934746022932"/><point x="6907.9833031643" y="4706.294719097549"/><point x="-108" y="4690.988193699843"/><point x="-97.17678556185528" y="-270"/></crop-area><partial-xform><m11>0.9999976201773518</m11><m12>0.00218165983433677</m12><m21>-0.00218165983433677</m21><m22>0.9999976201773518</m22></partial-xform><dpi horizontal="600" vertical="600"/><color-params colorMode="bw"><color-or-grayscale fillMargins="1" fillOffcut="1" fillingColor="background" normalizeIlluminationColor="0"><posterization-options enabled="0" forceBlackAndWhite="1" level="4" normalizationEnabled="0"/></color-or-grayscale><bw binarizationMethod="edgeplus" morphologicalSmoothing="1" normalizeIlluminationBW="1" sauvolaCoef="0.34" savitzkyGolaySmoothing="1" thresholdAdj="0" windowSize="200" wolfCoef="0.3" wolfLowerBound="1" wolfUpperBound="254"><color-segmenter-options blueThresholdAdjustment="0" enabled="0" greenThresholdAdjustment="0" noiseReduction="7" redThresholdAdjustment="0"/></bw></color-params><splitting originalBackground="0" splitOutput="0" splittingMode="bw"/><picture-shape-options higherSearchSensitivity="0" pictureShape="free" sensitivity="100"/><dewarping-options mode="off" postDeskew="1" postDeskewAngle="0"/><processing-params autoZonesFound="0" blackOnWhiteSetManually="0"/></image><source_file mtime="1698783384" size="2890349"/><file mtime="1699419143" size="26720"/><speckles mtime="1699419143" size="682"/><zones/><fill-zones/></output-params></page></output></filters></project>"#;
        const BLUR_DIV: &str = r#"<project layoutDirection="LTR" outputDirectory="/home/ramzi/src/bill-organizer/out" version="3"><directories><directory id="1" path="/home/ramzi/src/bill-organizer"/></directories><files><file dirId="1" id="2" name="in.jpg"/></files><images><image fileId="2" fileImage="0" id="3" subPages="1"><size height="4961" width="7016"/><dpi horizontal="600" vertical="600"/></image></images><pages><page id="4" imageId="3" selected="selected" subPage="single"/></pages><file-name-disambiguation><mapping file="2" label="0"/></file-name-disambiguation><filters><fix-orientation><image-settings><page id="4"><image-params blackOnWhite="1" bwThreshold="193"/></page></image-settings></fix-orientation><page-split defaultLayoutType="auto-detect"><image id="3" layoutType="single-uncut"><params mode="auto"><pages type="single-uncut"><outline><point x="0" y="0"/><point x="7016" y="0"/><point x="7016" y="4961"/><point x="0" y="4961"/><point x="0" y="0"/></outline></pages><dependencies><rotation degrees="0"/><size height="4961" width="7016"/><layoutType>single-uncut</layoutType></dependencies></params></image></page-split><deskew><page id="4"><params angle="0.125" mode="auto"><dependencies><rotation degrees="0"/><page-outline><point x="0" y="0"/><point x="7016" y="0"/><point x="7016" y="4961"/><point x="0" y="4961"/><point x="0" y="0"/></page-outline></dependencies></params></page><image-settings><page id="4"><image-params blackOnWhite="1" bwThreshold="193"/></page></image-settings></deskew><select-content pageDetectionTolerance="0.1"><page id="4"><params contentDetectionMode="auto" fineTuneCorners="0" pageDetectionMode="disabled"><content-rect height="3384" width="2260" x="344" y="388"/><page-rect height="4976.294719097549" width="7026.806517602445" x="0" y="0"/><content-size-mm height="143.256286512573" width="95.6735246803827"/><dependencies><rotated-page-outline><point x="10.82321443814471" y="0"/><point x="7026.806517602445" y="15.30652539770678"/><point x="7015.9833031643" y="4976.294719097549"/><point x="0" y="4960.988193699843"/><point x="10.82321443814471" y="0"/></rotated-page-outline><params contentDetectionMode="auto" fineTuneCorners="0" pageDetectionMode="disabled"/></dependencies></params></page></select-content><page-layout showMiddleRect="1"><page id="4"><params autoMargins="0"><hardMarginsMM bottom="5" left="10" right="10" top="5"/><pageRect height="4976.294719097549" width="7026.806517602445" x="0" y="0"/><contentRect height="3384" width="2260" x="344" y="388"/><contentSizeMM height="143.256286512573" width="95.6735246803827"/><alignment hor="center" null="0" vert="center"/></params></page></page-layout><output><page id="4"><zones/><fill-zones/><params blackOnWhite="1" depthPerception="2" despeckleLevel="1"><picture-shape-options higherSearchSensitivity="0" pictureShape="free" sensitivity="100"/><dewarping-options mode="off" postDeskew="1" postDeskewAngle="0"/><dpi horizontal="600" vertical="600"/><color-params colorMode="bw"><color-or-grayscale fillMargins="1" fillOffcut="1" fillingColor="background" normalizeIlluminationColor="0"><posterization-options enabled="0" forceBlackAndWhite="1" level="4" normalizationEnabled="0"/></color-or-grayscale><bw binarizationMethod="blurdiv" morphologicalSmoothing="1" normalizeIlluminationBW="1" sauvolaCoef="0.34" savitzkyGolaySmoothing="1" thresholdAdj="0" windowSize="200" wolfCoef="0.3" wolfLowerBound="1" wolfUpperBound="254"><color-segmenter-options blueThresholdAdjustment="0" enabled="0" greenThresholdAdjustment="0" noiseReduction="7" redThresholdAdjustment="0"/></bw></color-params><splitting originalBackground="0" splitOutput="0" splittingMode="bw"/></params><processing-params autoZonesFound="0" blackOnWhiteSetManually="0"/><output-params><image blackOnWhite="1" depthPerception="2" despeckleLevel="1"><size height="3620" width="2732"/><content-rect height="3384" width="2260" x="236" y="118"/><crop-area><point x="-97.17678556185528" y="-270"/><point x="6918.806517602445" y="-254.6934746022932"/><point x="6907.9833031643" y="4706.294719097549"/><point x="-108" y="4690.988193699843"/><point x="-97.17678556185528" y="-270"/></crop-area><partial-xform><m11>0.9999976201773518</m11><m12>0.00218165983433677</m12><m21>-0.00218165983433677</m21><m22>0.9999976201773518</m22></partial-xform><dpi horizontal="600" vertical="600"/><color-params colorMode="bw"><color-or-grayscale fillMargins="1" fillOffcut="1" fillingColor="background" normalizeIlluminationColor="0"><posterization-options enabled="0" forceBlackAndWhite="1" level="4" normalizationEnabled="0"/></color-or-grayscale><bw binarizationMethod="blurdiv" morphologicalSmoothing="1" normalizeIlluminationBW="1" sauvolaCoef="0.34" savitzkyGolaySmoothing="1" thresholdAdj="0" windowSize="200" wolfCoef="0.3" wolfLowerBound="1" wolfUpperBound="254"><color-segmenter-options blueThresholdAdjustment="0" enabled="0" greenThresholdAdjustment="0" noiseReduction="7" redThresholdAdjustment="0"/></bw></color-params><splitting originalBackground="0" splitOutput="0" splittingMode="bw"/><picture-shape-options higherSearchSensitivity="0" pictureShape="free" sensitivity="100"/><dewarping-options mode="off" postDeskew="1" postDeskewAngle="0"/><processing-params autoZonesFound="0" blackOnWhiteSetManually="0"/></image><source_file mtime="1698783384" size="2890349"/><file mtime="1699419163" size="26532"/><speckles mtime="1699419163" size="660"/><zones/><fill-zones/></output-params></page></output></filters></project>"#;
        const EDGE_DIV: &str = r#"<project layoutDirection="LTR" outputDirectory="/home/ramzi/src/bill-organizer/out" version="3"><directories><directory id="1" path="/home/ramzi/src/bill-organizer"/></directories><files><file dirId="1" id="2" name="in.jpg"/></files><images><image fileId="2" fileImage="0" id="3" subPages="1"><size height="4961" width="7016"/><dpi horizontal="600" vertical="600"/></image></images><pages><page id="4" imageId="3" selected="selected" subPage="single"/></pages><file-name-disambiguation><mapping file="2" label="0"/></file-name-disambiguation><filters><fix-orientation><image-settings><page id="4"><image-params blackOnWhite="1" bwThreshold="193"/></page></image-settings></fix-orientation><page-split defaultLayoutType="auto-detect"><image id="3" layoutType="single-uncut"><params mode="auto"><pages type="single-uncut"><outline><point x="0" y="0"/><point x="7016" y="0"/><point x="7016" y="4961"/><point x="0" y="4961"/><point x="0" y="0"/></outline></pages><dependencies><rotation degrees="0"/><size height="4961" width="7016"/><layoutType>single-uncut</layoutType></dependencies></params></image></page-split><deskew><page id="4"><params angle="0.125" mode="auto"><dependencies><rotation degrees="0"/><page-outline><point x="0" y="0"/><point x="7016" y="0"/><point x="7016" y="4961"/><point x="0" y="4961"/><point x="0" y="0"/></page-outline></dependencies></params></page><image-settings><page id="4"><image-params blackOnWhite="1" bwThreshold="193"/></page></image-settings></deskew><select-content pageDetectionTolerance="0.1"><page id="4"><params contentDetectionMode="auto" fineTuneCorners="0" pageDetectionMode="disabled"><content-rect height="3384" width="2260" x="344" y="388"/><page-rect height="4976.294719097549" width="7026.806517602445" x="0" y="0"/><content-size-mm height="143.256286512573" width="95.6735246803827"/><dependencies><rotated-page-outline><point x="10.82321443814471" y="0"/><point x="7026.806517602445" y="15.30652539770678"/><point x="7015.9833031643" y="4976.294719097549"/><point x="0" y="4960.988193699843"/><point x="10.82321443814471" y="0"/></rotated-page-outline><params contentDetectionMode="auto" fineTuneCorners="0" pageDetectionMode="disabled"/></dependencies></params></page></select-content><page-layout showMiddleRect="1"><page id="4"><params autoMargins="0"><hardMarginsMM bottom="5" left="10" right="10" top="5"/><pageRect height="4976.294719097549" width="7026.806517602445" x="0" y="0"/><contentRect height="3384" width="2260" x="344" y="388"/><contentSizeMM height="143.256286512573" width="95.6735246803827"/><alignment hor="center" null="0" vert="center"/></params></page></page-layout><output><page id="4"><zones/><fill-zones/><params blackOnWhite="1" depthPerception="2" despeckleLevel="1"><picture-shape-options higherSearchSensitivity="0" pictureShape="free" sensitivity="100"/><dewarping-options mode="off" postDeskew="1" postDeskewAngle="0"/><dpi horizontal="600" vertical="600"/><color-params colorMode="bw"><color-or-grayscale fillMargins="1" fillOffcut="1" fillingColor="background" normalizeIlluminationColor="0"><posterization-options enabled="0" forceBlackAndWhite="1" level="4" normalizationEnabled="0"/></color-or-grayscale><bw binarizationMethod="edgediv" morphologicalSmoothing="1" normalizeIlluminationBW="1" sauvolaCoef="0.34" savitzkyGolaySmoothing="1" thresholdAdj="0" windowSize="200" wolfCoef="0.3" wolfLowerBound="1" wolfUpperBound="254"><color-segmenter-options blueThresholdAdjustment="0" enabled="0" greenThresholdAdjustment="0" noiseReduction="7" redThresholdAdjustment="0"/></bw></color-params><splitting originalBackground="0" splitOutput="0" splittingMode="bw"/></params><processing-params autoZonesFound="0" blackOnWhiteSetManually="0"/><output-params><image blackOnWhite="1" depthPerception="2" despeckleLevel="1"><size height="3620" width="2732"/><content-rect height="3384" width="2260" x="236" y="118"/><crop-area><point x="-97.17678556185528" y="-270"/><point x="6918.806517602445" y="-254.6934746022932"/><point x="6907.9833031643" y="4706.294719097549"/><point x="-108" y="4690.988193699843"/><point x="-97.17678556185528" y="-270"/></crop-area><partial-xform><m11>0.9999976201773518</m11><m12>0.00218165983433677</m12><m21>-0.00218165983433677</m21><m22>0.9999976201773518</m22></partial-xform><dpi horizontal="600" vertical="600"/><color-params colorMode="bw"><color-or-grayscale fillMargins="1" fillOffcut="1" fillingColor="background" normalizeIlluminationColor="0"><posterization-options enabled="0" forceBlackAndWhite="1" level="4" normalizationEnabled="0"/></color-or-grayscale><bw binarizationMethod="edgediv" morphologicalSmoothing="1" normalizeIlluminationBW="1" sauvolaCoef="0.34" savitzkyGolaySmoothing="1" thresholdAdj="0" windowSize="200" wolfCoef="0.3" wolfLowerBound="1" wolfUpperBound="254"><color-segmenter-options blueThresholdAdjustment="0" enabled="0" greenThresholdAdjustment="0" noiseReduction="7" redThresholdAdjustment="0"/></bw></color-params><splitting originalBackground="0" splitOutput="0" splittingMode="bw"/><picture-shape-options higherSearchSensitivity="0" pictureShape="free" sensitivity="100"/><dewarping-options mode="off" postDeskew="1" postDeskewAngle="0"/><processing-params autoZonesFound="0" blackOnWhiteSetManually="0"/></image><source_file mtime="1698783384" size="2890349"/><file mtime="1699419183" size="26706"/><speckles mtime="1699419183" size="708"/><zones/><fill-zones/></output-params></page></output></filters></project>"#;

        for (content, expected_method) in [
            (OTSU, BinarizationMethod::Otsu),
            (SAUVOLA, BinarizationMethod::Sauvola),
            (WOLF, BinarizationMethod::Wolf),
            (EDGE_PLUS, BinarizationMethod::EdgePlus),
            (BLUR_DIV, BinarizationMethod::BlurDiv),
            (EDGE_DIV, BinarizationMethod::EdgeDiv),
        ] {
            let color_params = get_color_params(content);
            assert_eq!(
                color_params.bw.unwrap().binarization_method,
                expected_method
            );
        }
    }
}
